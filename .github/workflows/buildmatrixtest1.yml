name: test matrix
on: push
jobs:
  build:
     if: ${{ !contains(github.event.head_commit.message, 'ci skip') }}
     runs-on: ${{ matrix.os }}
     strategy:
       fail-fast: false
       matrix:
         os: [ubuntu-latest, macos-latest]
         include:
           - os: macos-latest
             TARGET: x86_64-apple-darwin
             COMPILER: clang
             LINKER: clang
             xNEST_BUILD_TYPE: "STATIC_CODE_ANALYSIS"
           - os: ubuntu-latest
             TARGET: armv7-unknown-linux-musleabihf
             COMPILER: arm-linux-gnueabihf-gcc-5
             LINKER: gcc-5-arm-linux-gnueabihf
             xNEST_BUILD_TYPE: "STATIC_CODE_ANALYSIS"
           - os: ubuntu-latest
             TARGET: x86_64-unknown-linux-musl
             COMPILER: gcc
             LINKER: gcc
             xNEST_BUILD_TYPE: "STATIC_CODE_ANALYSIS"
             #xNEST_BUILD_TYPE: "MINIMAL"
             
       #- name: MacOS
         #os: [ubuntu-latest, macos-latest]
     #runs-on: ${{ matrix.os }}
     steps:
                       
    #steps:
      #- uses: actions/checkout@v1
      #- run: echo ${{matrix.TARGET}}
     #steps:
        # Steps represent a sequence of tasks that will be executed as part of the job
       - name: Checkout repo content 
         #uses: actions/checkout@v2 # checkout the repository content to github runner.
         uses: actions/checkout@master
       - name: Matrix job  
         run: echo ${{matrix.TARGET}}
        
       - name: Say Something
         run: |
           echo "Hello ${message}"
           echo "Again Welcome"
           echo $PATH
           echo $PWD
         shell: bash
       - name: Set up Python 3.x
         uses: actions/setup-python@v2
         with:
           python-version: 3.9
        #run: echo "Welcome to the NEST static analysis build"
         env:
           key: xNEST_BUILD_TYPE= STATIC_CODE_ANALYSIS
       - name: MacOS
         if: runner.os =='macOS'
         run: |
            brew install coreutils gsl open-mpi automake autoconf libtool
            brew info python
       - name: Install dependencies
         #uses: actions/cache@master
         run: |
            python -m pip install --upgrade pip setuptools
            python -m pip install scipy junitparser numpy nose cython matplotlib terminaltables
            python -m pip install nose
            pip list
            g++ --version
            set -o pipefail
            chmod +x extras/staticbuild.sh
            ./extras/staticbuild.sh
       #- name: Full build
       #  env:
       #    key: xNEST_BUILD_TYPE=FULL
       #  run: echo "Full build"
                      
  
    
